package DSproject;

public class InvIndexPhotoManager {
        BST<LinkedList<Photo>> InvIndex;
        
        // Constructor
        public InvIndexPhotoManager()
        {
        	InvIndex = new BST<LinkedList<Photo>>();
        }
        
        // Add a photo
      public void addPhoto(Photo p) {
	    LinkedList<String> tags = p.getTags();
	    if (tags.empty()) 
	    	return;

	    tags.findfirst();
	    while (true) {
	        String tag = tags.retrieve();
	        
	        if (InvIndex.findkey(tag)) {
	            LinkedList<Photo> photoList = InvIndex.retrieve();
	            photoList.insert(p);
	            InvIndex.update(tag, photoList);
	        } 
	        
	        else {
	            LinkedList<Photo> newList = new LinkedList<>();
	            newList.insert(p);
	            InvIndex.insert(tag, newList);
	        }

	        if (tags.last()) 
	        	break;
	        
	        tags.findnext();
	    }
	}

        // Delete a photo
        public void deletePhoto(String path)
        {
            String AllTags = InvIndex.inOrder();
            if (AllTags.length() == 0)
               AllTags += " ";
            else
                AllTags += " AND " + " ";
                
            String[] tags = AllTags.split(" AND ");
            
            for ( int i = 0; i < tags.length ; i++)
            {
            	InvIndex.findkey(tags[i]);
               LinkedList<Photo> photos_inverted = InvIndex.retrieve();
               photos_inverted.findfirst();
               while ( ! photos_inverted.last())
               {
                   if ( photos_inverted.retrieve().getPath().compareToIgnoreCase(path) == 0)
                   {
                       photos_inverted.remove();
                       break;
                   }
                   else
                      photos_inverted.findnext();
                   
               }   
               if (photos_inverted.retrieve().getPath().compareToIgnoreCase(path) == 0)
                    photos_inverted.remove();
               
               if ( photos_inverted.getCount() == 0)
            	   InvIndex.removeKey(tags[i]);
               else
            	   InvIndex.update(tags[i], photos_inverted);
            }
        }
        
        // Return the inverted index of all managed photos
        public BST<LinkedList<Photo>> getPhotos()
        {
            return InvIndex;
        }
 }
